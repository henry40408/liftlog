{% extends "base.html" %}

{% block title %}Workout {{ workout.date }} - LiftLog{% endblock %}

{% block content %}
{% include "nav.html" %}

<h1>Workout: {{ workout.date }}</h1>

{% match workout.notes %}
{% when Some with (notes) %}
<p class="muted"><em>{{ notes }}</em></p>
{% when None %}
{% endmatch %}

<div class="actions">
    <a href="/workouts/{{ workout.id }}/edit">[Edit]</a>
    <form action="/workouts/{{ workout.id }}/delete" method="post" style="display:inline;"
          onsubmit="return confirm('Delete this workout?');">
        <button type="submit" class="btn-small btn-inline">[Delete]</button>
    </form>
</div>

<h2>Sets</h2>

{% if let Some(err) = error %}
<div class="error">{{ err }}</div>
{% endif %}

{% if logs.is_empty() %}
<p class="muted">No sets recorded yet.</p>
{% else %}
<table>
    <thead>
        <tr>
            <th>Exercise</th>
            <th>Set</th>
            <th>Weight</th>
            <th>Reps</th>
            <th>RPE</th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for log in logs %}
        <tr>
            <td><a href="/stats/exercise/{{ log.exercise_id }}">{{ log.exercise_name }}</a></td>
            <td>{{ log.set_number }}</td>
            <td>{{ log.weight }}</td>
            <td>{{ log.reps }}</td>
            <td>{% match log.rpe %}{% when Some with (r) %}{{ r }}{% when None %}-{% endmatch %}</td>
            <td>{% if log.is_pr %}<span class="pr-badge">PR</span>{% endif %}</td>
            <td>
                <button type="button" class="btn-small btn-inline" onclick="cloneSet('{{ log.exercise_id }}', {{ log.weight }}, {{ log.reps }}, {% match log.rpe %}{% when Some with (r) %}{{ r }}{% when None %}null{% endmatch %})">[Clone]</button>
                <form action="/workouts/{{ workout.id }}/logs/{{ log.id }}/delete" method="post" style="display:inline;"
                      onsubmit="return confirm('Delete this set?');">
                    <button type="submit" class="btn-small btn-inline">[x]</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<h3>Add Set</h3>
<form method="post" action="/workouts/{{ workout.id }}/logs">
    <div class="form-group">
        <label for="exercise_id">Exercise</label>
        <select id="exercise_id" name="exercise_id" required>
            <option value="">-- Select --</option>
            {% for ex in exercises %}
            <option value="{{ ex.id }}">{{ ex.name }} ({{ ex.category }})</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="weight">Weight</label>
        <input type="number" id="weight" name="weight" step="0.5" min="0" required>
    </div>
    <div class="form-group">
        <label for="reps">Reps</label>
        <input type="number" id="reps" name="reps" min="1" required>
    </div>
    <div class="form-group">
        <label for="rpe">RPE (1-10, optional)</label>
        <input type="number" id="rpe" name="rpe" min="1" max="10">
    </div>
    <button type="submit">[Add Set]</button>
</form>

<div class="link">
    &larr; <a href="/workouts">[Back to Workouts]</a>
</div>

<script>
function cloneSet(exerciseId, weight, reps, rpe) {
    document.getElementById('exercise_id').value = exerciseId;
    document.getElementById('weight').value = weight;
    document.getElementById('reps').value = reps;
    if (rpe !== null) {
        document.getElementById('rpe').value = rpe;
    } else {
        document.getElementById('rpe').value = '';
    }
    document.getElementById('exercise_id').scrollIntoView({ behavior: 'smooth' });
}
</script>
{% endblock %}
