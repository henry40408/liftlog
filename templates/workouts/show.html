{% extends "base.html" %}

{% block title %}Workout {{ workout.date }} - LiftLog{% endblock %}

{% block content %}
{% include "nav.html" %}

<h1>Workout: {{ workout.date }}</h1>

{% if let Some(notes) = workout.notes %}
<p><em>{{ notes }}</em></p>
{% endif %}

<p>
    <a href="/workouts/{{ workout.id }}/edit">Edit</a> |
    <form action="/workouts/{{ workout.id }}/delete" method="post" style="display:inline;"
          onsubmit="return confirm('Delete this workout?');">
        <button type="submit">Delete</button>
    </form>
</p>

<h2>Sets</h2>

{% if let Some(err) = error %}
<p style="color: red;">{{ err }}</p>
{% endif %}

{% if logs.is_empty() %}
<p>No sets recorded yet.</p>
{% else %}
<table>
    <thead>
        <tr>
            <th>Exercise</th>
            <th>Set</th>
            <th>Weight</th>
            <th>Reps</th>
            <th>RPE</th>
            <th>PR</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for log in logs %}
        <tr>
            <td><a href="/stats/exercise/{{ log.exercise_id }}">{{ log.exercise_name }}</a></td>
            <td>{{ log.set_number }}</td>
            <td>{{ log.weight }}</td>
            <td>{{ log.reps }}</td>
            <td>{% match log.rpe %}{% when Some with (r) %}{{ r }}{% when None %}-{% endmatch %}</td>
            <td>{% if log.is_pr %}*PR*{% endif %}</td>
            <td>
                <form action="/workouts/{{ workout.id }}/logs/{{ log.id }}/delete" method="post" style="display:inline;"
                      onsubmit="return confirm('Delete this set?');">
                    <button type="submit">X</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<h3>Add Set</h3>
<form method="post" action="/workouts/{{ workout.id }}/logs">
    <p>
        <label>Exercise:<br>
            <select name="exercise_id" required>
                <option value="">-- Select --</option>
                {% for ex in exercises %}
                <option value="{{ ex.id }}">{{ ex.name }} ({{ ex.category }})</option>
                {% endfor %}
            </select>
        </label>
    </p>
    <p>
        <label>Weight:<br>
            <input type="number" name="weight" step="0.5" min="0" required>
        </label>
    </p>
    <p>
        <label>Reps:<br>
            <input type="number" name="reps" min="1" required>
        </label>
    </p>
    <p>
        <label>RPE (1-10, optional):<br>
            <input type="number" name="rpe" min="1" max="10">
        </label>
    </p>
    <p>
        <button type="submit">Add Set</button>
    </p>
</form>

<p><a href="/workouts">&larr; Back to Workouts</a></p>
{% endblock %}
